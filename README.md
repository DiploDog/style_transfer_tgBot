# Отчет о выполнении задания
В ходе выполнения контрольного задания была построена модель [Гатиса](https://arxiv.org/abs/1508.06576)
и реализован перенос стиля с одного изображения на целевое по методике
Neural Style Transfer.
В проекте реализованы следующие требования:
- Релизована модель NST, функциональность которой перенесена в классы
- Создан telegram-бот, позволяющий пользователю производить перенос стиля с одного изображения на другое
- Реализация бота выполнена при помощи [asyncio](https://docs.python.org/3/library/asyncio.html) и [aiogram](https://docs.aiogram.dev/en/latest/), т.е. интерфейс бота асинхронен.
- Интерфейс бота и общение с ним, на мой взгляд, выполнено с достаточной степенью интуитивности.
- Deploy бота осуществлен на [![Heroku](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/).


## Основные трудности при реализации проекта
Отсутствие строгих рамок и требований к выполнению проекта вызвали
эффект ребенка в магазине сладостей. Выбор и изучение разнообразных
моделей, фреймворков и библиотек значительно сузил и без того неширокие
временные рамки.

В связи с этим: 
- не удалось в достаточной мере изучить и внедрить
библиотеку threading в проект для распределения задач проекта, из-за
чего асинхронным в данном боте является только интерфейс, а выполнение
переноса стиля является блокирующим;


- корректировка проекта в соответствии с требованиями бесплатного тарифа 
на Heroku, отняла несправедливо много времени из-за ошибки **SIGKILL**
и катастрофической нехватки памяти, из-за чего пришлось значительно
снизить количество итераций прогона картинок через слои сети;


- эта же проблема привела к тому, что скачивание целой **vgg19** из 
**torch.models** вызывала **SIGKILL** при развертке модели на сервере,
поэтому веса модели Гатиса скачаны отдельно и загружаются в
процессе инициирования модели;


- бесперебойную работу бота также не удалось реализовать из-за
нехватки памяти на тарифе **Hobby**, поэтому
написан **handler** для обработки внезапных ошибок при *run*'e
переноса стиля;


- в **handlers/users/default_menu.py** закомментирован **handler**,
который должен был представлять собой "функционал для разработчиков",
предоставляющий, при нажатии на кнопку "Режим разработчика", 
логи последних лоссов работы модели в файле формата .csv


- постоянное засыпание бота, о котором так много говорилось в чате 
**Slack'а** было устранено, как мне кажется, тем, что в Procfile
устанавливается исполнитель не *web*, а *worker*;


- не удалось выполнить автоматическое задание переменных окружений
на сервере *Heroku*, они были заданы в терминале при помощи команд:


```
$ heroku config:set BOT_TOKEN=<my_bot_token>
$ heroku config:set ADMINS=<admins_id>
```


## Благодарности
Бот реализован по структуре, предлагаемой в репозитории [Latand'а](https://github.com/Latand/aiogram-bot-template)

Модель реализована при поддержке [ФПМИ МФТИ](https://www.youtube.com/c/DeepLearningSchool/featured)
